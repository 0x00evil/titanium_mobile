<html>
<head>
<script>
	window.onload = function()
	{
		Titanium.API.info("Très 漢字");
		
		var movieTimedStart = null;
		
		function showCamera()
		{
			Titanium.Media.showCamera({

				success:function(image,details)
				{
					var win = Titanium.UI.createWindow({url:'image.html'});
					Titanium.App.Properties.setString('photo',image.url);
					Titanium.App.Properties.setBool('movie',false);

					if (details)
					{
						Titanium.App.Properties.setString('x',details.cropRect.x);
						Titanium.App.Properties.setString('y',details.cropRect.y);
						Titanium.App.Properties.setString('height',details.cropRect.height);
						Titanium.App.Properties.setString('width',details.cropRect.width);
						
					}
					else
					{
						Titanium.App.Properties.setString('x',0);
						Titanium.App.Properties.setString('y',0);
						Titanium.App.Properties.setString('height',image.height);
						Titanium.App.Properties.setString('width',image.width);
					}

					win.open();

				},
				cancel:function()
				{

				},
				error:function(error)
				{
					// create alert
					var a = Titanium.UI.createAlertDialog();

					// set title
					a.setTitle('Camera Error');

					// set message
					if (error.code == Titanium.Media.NO_CAMERA)
					{
						a.setMessage('Device does not have camera');
					}
					else
					{
						a.setMessage('Unexpected error: ' + error.code);
					}

					// set button names
					a.setButtonNames(['OK']);

					// show alert
					a.show();
				},
				allowImageEditing:true
			});
		};


		function playMovie()
		{
			var activeMovie = Titanium.Media.createVideoPlayer({
				contentURL:'movie.m4v',
				backgroundColor:'#111',
				movieControlMode:Titanium.Media.VIDEO_CONTROL_DEFAULT,
				scalingMode:Titanium.Media.VIDEO_SCALING_MODE_FILL
			});

			activeMovie.addEventListener('complete',function()
			{
				if (null !== movieTimedStart)
				{
					Titanium.Analytics.timedEvent('phone.play_movie',movieTimedStart, new Date());
					movieTimedStart = null;
				}
				var a = Titanium.UI.createAlertDialog();
				a.setMessage('Video Completed');
				a.show();
			});

			movieTimedStart = new Date();
			// play movie
			activeMovie.play();

		};
		
		document.getElementById("pl").addEventListener('click',function()
		{
			playMovie();
		});

		document.getElementById("p").addEventListener('click',function()
		{
			showCamera();
		});

		/*
		
		document.getElementById("s").addEventListener('click',function()
		{
			var sound = Titanium.Media.createSound("song.mp3");
			sound.play();
		});
		
		document.getElementById("ss").addEventListener('click',function()
		{
			Titanium.Media.takeScreenshot(function(media)
			{
				document.getElementById('i').src = media.url;
				Titanium.Media.saveToPhotoGallery(media);
			});
		});
		
		var movieUrl = 'movie.m4v';
		
		var doMediaThing = function(media,details,image){
			var activeMovie = Titanium.Media.createVideoPlayer({
							contentURL:movieUrl, //media.url,
							backgroundColor:'#111',
							movieControlMode:Titanium.Media.VIDEO_CONTROL_DEFAULT,
							scalingMode:Titanium.Media.VIDEO_SCALING_MODE_FILL
			});
			activeMovie.addEventListener('complete',function()
			{
					Ti.API.info("video completed");
			});

			document.getElementById("mediatype").innerHTML = details.mediaType;
			
			if(image){
				document.getElementById('i').src = image.url;
				
				Titanium.Media.saveToPhotoGallery(image.url);
			}
			activeMovie.stop();
			activeMovie.play();	
		};
		
		document.getElementById("pl").addEventListener('click',function()
		{
			doMediaThing(null,{mediaType:'fake'},null);
		});

		document.getElementById("b").addEventListener('click',function()
		{
			Titanium.Media.showCamera({
//			Titanium.Media.openPhotoGallery({
				success:function(media,details,image){movieUrl=media.url;
					window.setTimeout(doMediaThing,100,media,details,image);},
				cancel:function()
				{
				},
				error:function()
				{
				},
				animated:false,
				allowImageEditing:true,
				mediaTypes: [Titanium.Media.MEDIA_TYPE_VIDEO],
				videoMaximumDuration:10000,
				videoQuality:Titanium.Media.QUALITY_HIGH
			});
		});*/
	};
</script>
</head>
<body>
<div style="margin-top:100px;width:300px;margin:auto;"><button id="b" style="font-size:24px;">Make video</button></div>
<div style="margin-top:100px;width:300px;margin:auto;"><button id="s" style="font-size:24px;">Play sound</button></div>
<div style="margin-top:100px;width:300px;margin:auto;"><button id="p" style="font-size:24px;">Make Picture</button></div>
<div style="margin-top:100px;width:300px;margin:auto;"><button id="ss" style="font-size:24px;">Take Screenshot</button></div>
<div style="margin-top:100px;width:300px;margin:auto;"><button id="pl" style="font-size:24px;">Play video</button></div>
<div id="mediatype"></div>
<div><img id="i" width="100" height="100"/></div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
<div style="height:25px;">foo</div>
</body>
</html>