<html>
<head>
	<title>Phone API</title>

	<script>

	// currently, push notifications are only supported for iphone
	if (Titanium.Platform.name != 'android')
	{
		Titanium.Network.registerForPushNotifications({
			types: [Titanium.Network.NOTIFICATION_TYPE_BADGE,Titanium.Network.NOTIFICATION_TYPE_ALERT,Titanium.Network.NOTIFICATION_TYPE_SOUND],
			success:function(e)
			{
				Titanium.API.info("registered device id is: "+e);
				
				//NOTE: this value is also available as the property Titanium.Network.remoteDeviceUUID
			},
			error: function(e)
			{
				Titanium.API.warn("push notifications disabled: "+e);
			},
			callback:function(e)
			{
				var a = Titanium.UI.createAlertDialog();
				a.setMessage("callback: "+Titanium._JSON(e));
				a.show();
			}
		});
	}

	// NOTE: you can show arguments that the app was launched with if you
	// want by uncommenting this
	/*
	var a = Titanium.UI.createAlertDialog();
	a.setMessage("arguments: "+Titanium._JSON(Titanium.App.getArguments()));
	a.show();
	*/
	
	

	Titanium.UI.addEventListener('tabchange',function(e)
	{
		Titanium.API.info('TABCHANGE index ' + e.index  + ' name ' + e.name + ' prevIndex ' + e.prevIndex + ' prevName ' + e.prevName);
	});

	var template = {
	 selectedBackgroundImage:'table_view_bg.png', 
	 selectedColor:'white',
	 color:'brown',
	 layout:[
	   {type:'text', left:50,  name:'title', fontWeight:'bold'}
	]};
	// data for tableview
	var data = [
		{title:'Play Movie',backgroundImage:'images/tableview/off_1.png', 
				selectedBackgroundImage:'images/tableview/on_1.png'},
		{title:'Camera',backgroundImage:'images/tableview/off_2.png',
				selectedBackgroundImage:'images/tableview/on_2.png'},
		{title:'Vibrate',backgroundImage:'images/tableview/off_3.png',
				selectedBackgroundImage:'images/tableview/on_3.png'},
		{title:'Orientation',backgroundImage:'images/tableview/off_4.png',
			selectedBackgroundImage:'images/tableview/on_4.png'},
		{title:'Photo Gallery',backgroundImage:'images/tableview/off_1.png',
				selectedBackgroundImage:'images/tableview/on_1.png'},
		{title:'Geo Location',backgroundImage:'images/tableview/off_2.png',
				selectedBackgroundImage:'images/tableview/on_2.png'},
		{title:'Accelerometer',backgroundImage:'images/tableview/off_3.png',
				selectedBackgroundImage:'images/tableview/on_3.png'},
		{title:'Sound',backgroundImage:'images/tableview/off_4.png',
				selectedBackgroundImage:'images/tableview/on_4.png'},
		{title:'Shake',backgroundImage:'images/tableview/off_1.png',
				selectedBackgroundImage:'images/tableview/on_1.png'},
		{title:'Email Client',backgroundImage:'images/tableview/off_2.png',
				selectedBackgroundImage:'images/tableview/on_2.png'},
		{title:'Save to Gallery',backgroundImage:'images/tableview/off_3.png',
				selectedBackgroundImage:'images/tableview/on_3.png'},
		{title:'Contacts',backgroundImage:'images/tableview/off_4.png',
				 selectedBackgroundImage:'images/tableview/on_4.png'}
	];
	Titanium.UI.currentWindow.setTitle('Phone API');
	// tableview object
	var tableView = Titanium.UI.createTableView({template:template,backgroundColor:'transparent', borderColor:'transparent',
		data:data,
		
	}, function(eventObject)
	{
		Titanium.API.info('HERE I AM ' + eventObject.index)
		// handle tableview click events
		var idx = eventObject.index;
		switch(idx)
		{
			case 0:
			{
				playMovie();
				break;
			}
			case 1:
			{
				//FIXME: this is just for iphone right now, will fix shortly!
				
				// create dialog
				var dialog = Titanium.UI.createOptionDialog();

				// set button titles
				dialog.setOptions(["Record Video","Take Picture","Test Both","Cancel"]);

				// set index for cancel (IPHONE ONLY)
				dialog.setCancel(3);

				// set title
				dialog.setTitle('Camera Options');

				// add event listener
				dialog.addEventListener('click',function(e)
				{
					Titanium.API.info("clicked ="+e.index);
					
					switch(e.index)
					{
						case 0:
						{
							recordVideo();
							break;
						}
						case 1:
						{
							showCamera();
							break;
						}
						case 2:
						{
							//FIXME
						}
					}
				});

				// show dialog
				dialog.show();

				break;
			}
			case 2:
			{
				Titanium.Media.vibrate();
				break;
			}
			case 3:
			{
				var win = Titanium.UI.createWindow({url:'orientation.html',title:'Orientation Change',barColor:'#000',backgroundColor:'#fff'});
				win.orientation ='either';
				win.open({animated:true});
				break;
			}
			case 4:
			{
				openPhotoGallery();
				break;
			}
			case 5:
			{
				var win = Titanium.UI.createWindow({url:'geo.html',title:'Geolocation', barColor:'#336699', backgroundColor:'#fff'});
				win.open({animated:true});
				break;
			}
			case 6:
			{
				var win = Titanium.UI.createWindow({url:'accelerometer.html',title:'Accelerometer', barColor:'#336699', backgroundColor:'#fff', orientation:'landscape'});
				win.open({animated:true});
				break;
			}
			case 7:
			{
				var win = Titanium.UI.createWindow({url:'sound.html',title:'Sound', barColor:'#336699', backgroundColor:'#fff'});
				win.open({animated:true});
				break;
			}
			case 8:
			{
				var win = Titanium.UI.createWindow({url:'shake.html',title:'Shake', barColor:'#336699', backgroundColor:'#fff', orientation:'portrait'});
				win.open({animated:true});
				break;
			}
			case 9:
			{
				var win = Titanium.UI.createWindow({url:'email.html',title:'Email', barColor:'#336699', backgroundColor:'#fff'});
				win.open({animated:true});
				break;
			}
			case 10:
			{
				savePhoto();
				break;
			}
			case 11:
			{
				showContacts();
				break;
			}
		}

	});
	Titanium.UI.currentWindow.addView(tableView);
	Titanium.UI.currentWindow.showView(tableView);

	// FUNCTIONS

	//
	// play movie
	//
	function playMovie()
	{
		var activeMovie = Titanium.Media.createVideoPlayer({
				contentURL:'movie.mp4',
				backgroundColor:'#111',
				movieControlMode:Titanium.Media.VIDEO_CONTROL_DEFAULT,
				scalingMode:Titanium.Media.VIDEO_SCALING_MODE_FILL

		});

		activeMovie.addEventListener('complete',function()
		{
			var a = Titanium.UI.createAlertDialog();
			a.setMessage('Video Completed');
			a.show();
		});

		// play movie
		activeMovie.play();

	};
	
	
	//record version -- only works on iphone 3 with 3GS
	
	function recordVideo()
	{
		Titanium.API.info("Record video");
		
		Titanium.Media.showCamera({
	
			success:function(image,details)
			{
				var win = Titanium.UI.createWindow({url:'image.html'});
				Titanium.App.Properties.setString('photo',image.url);
				if (details)
				{
					Titanium.App.Properties.setString('x',details.cropRect.x);
					Titanium.App.Properties.setString('y',details.cropRect.y);
					Titanium.App.Properties.setString('height',details.cropRect.height);
					Titanium.App.Properties.setString('width',details.cropRect.width);
				}
				win.open({animated:true});
	
			},
			cancel:function()
			{
	
			},
			error:function(error)
			{
				Titanium.API.info("getting error = "+error);
				
				// create alert
				var a = Titanium.UI.createAlertDialog();
	
				// set title
				a.setTitle('Camera Error');
	
				// set message
				if (error.code == Titanium.Media.NO_VIDEO)
				{
					a.setMessage('Device does not have video recording capabilities');
				}
				else
				{
					a.setMessage('Unexpected error: ' + error.code);
				}
	
				// set button names
				a.setButtonNames(['OK']);
	
				// show alert
				a.show();
			},
			allowImageEditing:true,
			mediaTypes: Titanium.Media.MEDIA_TYPE_VIDEO,
			videoMaximumDuration:10000,
			videoQuality:Titanium.Media.QUALITY_HIGH
		});
	};
	

	//
	// show camera
	//
	function showCamera()
	{
		Titanium.Media.showCamera({

			success:function(image,details)
			{
				var win = Titanium.UI.createWindow({url:'image.html'});
				Titanium.App.Properties.setString('photo',image.url);
				if (details)
				{
					Titanium.App.Properties.setString('x',details.cropRect.x);
					Titanium.App.Properties.setString('y',details.cropRect.y);
					Titanium.App.Properties.setString('height',details.cropRect.height);
					Titanium.App.Properties.setString('width',details.cropRect.width);
				}
				win.open({animated:true});

			},
			cancel:function()
			{

			},
			error:function(error)
			{
				// create alert
				var a = Titanium.UI.createAlertDialog();

				// set title
				a.setTitle('Camera Error');

				// set message
				if (error.code == Titanium.Media.NO_CAMERA)
				{
					a.setMessage('Device does not have camera');
				}
				else
				{
					a.setMessage('Unexpected error: ' + error.code);
				}

				// set button names
				a.setButtonNames(['OK']);

				// show alert
				a.show();
			},
			allowImageEditing:true
		});
	};


	//
	// open photo gallery
	//
	function openPhotoGallery()
	{
		Titanium.Media.openPhotoGallery({
			success: function(image,details)
			{
				var win = Titanium.UI.createWindow({url:'image.html',title:'Image'});
				Titanium.App.Properties.setString('photo',image.url);
				if (details)
				{
					Titanium.App.Properties.setString('x',details.cropRect.x);
					Titanium.App.Properties.setString('y',details.cropRect.y);
					Titanium.App.Properties.setString('height',details.cropRect.height);
					Titanium.App.Properties.setString('width',details.cropRect.width);
				}
				else
				{
					Titanium.App.Properties.setString('x',0);
					Titanium.App.Properties.setString('y',0);
					Titanium.App.Properties.setString('height',image.height);
					Titanium.App.Properties.setString('width',image.width);
				}
				win.open({animated:true});
			},
			error: function(error)
			{
				Titanium.UI.createAlertDialog( {
					title: "Error from Gallery",
					message: error.message,
					buttonNames: OK
				} ).show();
			},
			cancel: function()
			{

			},
			allowImageEditing:true
		});

	};


	//
	// show camera
	//
	function savePhoto()
	{
		Titanium.Media.showCamera({

			success:function(image,details)
			{
				Titanium.Media.saveToPhotoGallery(image);
			},
			cancel:function()
			{

			},
			error:function(error)
			{
				// create alert
				var a = Titanium.UI.createAlertDialog();

				// set title
				a.setTitle('Camera Error');

				// set message
				if (error.code = Titanium.Media.NO_CAMERA)
				{
					a.setMessage('Device does not have camera');
				}
				else
				{
					a.setMessage('Unexpected error: ' + error.code);
				}

				// set button names
				a.setButtonNames(['OK']);

				// show alert
				a.show();
			},
			allowImageEditing:true
		});
	};
	
	function showContacts()
	{
		var win = Titanium.UI.createWindow({url:'contacts.html'});
		win.open({animated:true});
	}

	</script>
</head>
<body>

</body>
</html>