<html>
<head>
	<title>Contacts</title>
	<script>
	window.onload  = function()
	{
		// helper variable used to control update/create mode for contacts
		var mode = 'ADD';
		var contactToUpdate = null;
		
		var detailTemplate = {
			layout:[
				{type:'text', name:'title', fontSize:13, color:'grey', left:5},
				{type:'text', name:'value', fontSize:15, color:'blue', left:130},
				
			]
		}
		var detailTableView = Titanium.UI.createTableView({template:detailTemplate}, function(e)
		{
			if (e.index==0)
			{
				Titanium.UI.currentWindow.showView(Titanium.UI.currentWindow.getViews()[0],{
					animated:true,
					animationStyle:Titanium.UI.iPhone.AnimationStyle.FLIP_FROM_LEFT,
					animationDuration:1000
				});
				
			}
		});
		
		// 
		// display a selected contact
		//
		function displayContact(c)
		{
			var data = [];
			data.push({title:'Go Back', layout:[{color:'blue',fontWeight:'bold',fontSize:20}]});
			data.push({title:'firstName', value:((c.firstName)?c.firstName:'not specified')});
			data.push({title: 'lastName', value:((c.lastName)?c.lastName:'not specified')});
			data.push({title: 'middleName', value:((c.middleName)?c.middleName:'not specified')});
			data.push({title:'prefix', value:((c.prefix)?c.prefix:'not specified')});
			data.push({title: 'suffix', value:((c.suffix)?c.suffix:'not specified')});
			data.push({title: 'nickname', value:((c.nickname)?c.nickname:'not specified')});
			data.push({title: 'phoneticFirstName', value:((c.phoneticFirstName)?c.phoneticFirstName:'not specified')});
			data.push({title: 'phoneticLastName', value:((c.phoneticLastName)?c.phoneticLastName:'not specified')});
			data.push({title: 'phoneticMiddleName', value:((c.phoneticMiddleName)?c.phoneticMiddleName:'not specified')});
			data.push({title: 'organization', value:((c.organization)?c.organization[0].value.company:'not specified')});
			data.push({title: 'email', value:((c.email[0])?c.email[0].value:'not specified')});			
			data.push({title: 'birthday', value:((c.birthday)?c.birthday:'not specified')});
			data.push({title: 'note', value:((c.note[0])?c.note[0].value:'not specified')});
			data.push({title: 'creationDate', value:((c.creationDate)?c.creationDate:'not specified')});
			data.push({title: 'modificationDate', value: 
			 		+ ((c.modificationDate)?c.modificationDate:'not specified')});
			data.push({title: 'date', value:((c.date)?c.date:'not specified')});
			data.push({title: 'phone', value:((c.phone[0])?c.phone[0].value:'not specified')});
			data.push({title: 'instantMessenge', value:((c.instantMessenger)?c.instantMessenger:'not specified')});
			data.push({title: 'url', value:((c.url)?c.url:'not specified')});
			data.push({title: 'relatives', value:((c.relatives)?c.relatives:'not specified')});
			data.push({title: 'displayLabel', value:((c.displayLabel)?c.displayLabel:'not specified')});
			data.push({title: 'displayName', value:((c.displayName)?c.displayName:'not specified')});
			data.push({title: 'street1', value:((c.address[0])?c.address[0].value.street1:'not specified')});
			data.push({title: 'city', value:((c.address[0])?c.address[0].value.city:'not specified')});
			data.push({title: 'region1', value:((c.address[0])?c.address[0].value.region1:'not specified')});
			data.push({title: 'postalCode', value:((c.address[0])?c.address[0].value.postalCode:'not specified')});
			data.push({title: 'countryCode', value:((c.address[0])?c.address[0].value.countryCode:'not specified')});
			data.push({title: 'displayAddress', value:((c.address[0])?c.address[0].value.displayAddress:'not specified')});

			// use c.imageData to get image for contact

			detailTableView.setData(data);
			Titanium.UI.currentWindow.showView(detailTableView,{
				animated:true,
				animationStyle:Titanium.UI.iPhone.AnimationStyle.FLIP_FROM_LEFT,
				animationDuration:1000
			});
			
		};

		//
		// get all contacts and display in table view
		//
		function reloadContacts()
		{
			var data = [{title:'Go Back', layout:[{color:'blue',fontSize:14}]}];
			var contacts = Titanium.Contacts.getAllContacts();
			for (var i=0;i<contacts.length;i++)
			{
				data.push({title:contacts[i].displayName});
			}
			tableView.setData(data);
		};
		
		//
		//  button for showing contact picker 1
		//
		var button1 = Titanium.UI.createButton({
			id:'button1',
			backgroundImage:'images/BUTT_drk_off.png',
			backgroundSelectedImage:'images/BUTT_drk_on.png',
			backgroundFocusedImage:'images/BUTT_drk_on.png',
			title:'Contact Picker',
			color:'#ffffff',
			height:57,
			fontSize:18,
			fontWeight:'bold'
		});
		button1.addEventListener('click',function(e)
		{
			Titanium.Contacts.showContactPicker({
			
			   	success:function(e)
			   	{
					displayContact(e.contact);
			   	},
			   	cancel:function()
			   	{
			   	},
			   	details:['firstName','lastName','phone','email', 'organization']
			});
		});

		//
		// button for showing contact picker 2
		//
		var button2 = Titanium.UI.createButton({
			id:'button2',
			backgroundImage:'images/BUTT_drk_off.png',
			backgroundSelectedImage:'images/BUTT_drk_on.png',
			backgroundFocusedImage:'images/BUTT_drk_on.png',
			title:'Contact Picker (no detail)',
			color:'#ffffff',
			height:57,
			fontSize:18,
			fontWeight:'bold'
		});
		button2.addEventListener('click',function(e)
		{
			Titanium.Contacts.showContactPicker({
			
			   	success:function(e)
			   	{
					displayContact(e.contact);
			   	},
			   	cancel:function()
			   	{
			   	}
			});
		
		});

		//
		// button for adding new contact
		//
		var button3 = Titanium.UI.createButton({
			id:'button3',
			backgroundImage:'images/BUTT_grn_off.png',
			backgroundSelectedImage:'images/BUTT_grn_on.png',
			backgroundFocusedImage:'images/BUTT_grn_on.png',
			title:'Add Contact',
			color:'#ffffff',
			height:57,
			fontSize:18,
			fontWeight:'bold'
		});
		button3.addEventListener('click',function(e)
		{
			Titanium.UI.currentWindow.showView(groupedView,{
				animated:true,
				animationStyle:Titanium.UI.iPhone.AnimationStyle.FLIP_FROM_LEFT,
				animationDuration:1000
			});
			mode = 'ADD'
		});

		//
		// button for viewing all contacts
		//
		var button4 = Titanium.UI.createButton({
			id:'button4',
			backgroundImage:'images/BUTT_grn_off.png',
			backgroundSelectedImage:'images/BUTT_grn_on.png',
			backgroundFocusedImage:'images/BUTT_grn_on.png',
			title:'View Contacts',
			color:'#ffffff',
			height:57,
			fontSize:18,
			fontWeight:'bold'
		});
		button4.addEventListener('click',function(e)
		{
			reloadContacts();
			Titanium.UI.currentWindow.showView(tableView,{
				animated:true,
				animationStyle:Titanium.UI.iPhone.AnimationStyle.FLIP_FROM_LEFT,
				animationDuration:1000
			});
		});
		//
		// button for viewing all contacts
		//
		var button5 = Titanium.UI.createButton({
			id:'button5',
			backgroundImage:'images/BUTT_red_off.png',
			backgroundSelectedImage:'images/BUTT_red_on.png',
			backgroundFocusedImage:'images/BUTT_red_on.png',
			title:'Remove Contact',
			color:'#ffffff',
			height:57,
			fontSize:18,
			fontWeight:'bold'
		});
		button5.addEventListener('click',function(e)
		{
			Titanium.Contacts.showContactPicker({
			
			   	success:function(e)
			   	{
					Titanium.Contacts.removeContact(e.contact);
					Titanium.UI.createAlertDialog({title:'Contacts',message:'Contact removed.'}).show();
			   	},
			   	cancel:function()
			   	{
			   	}
			});
		});

		//
		// button for updating  contact
		//
		var button6 = Titanium.UI.createButton({
			id:'button6',
			backgroundImage:'images/BUTT_grn_off.png',
			backgroundSelectedImage:'images/BUTT_grn_on.png',
			backgroundFocusedImage:'images/BUTT_grn_on.png',
			title:'Update Contact',
			color:'#ffffff',
			height:57,
			fontSize:18,
			fontWeight:'bold'
		});
		button6.addEventListener('click',function(e)
		{
			Titanium.Contacts.showContactPicker({
			
			   	success:function(e)
			   	{
					contactToUpdate = e.contact;
					Titanium.UI.currentWindow.showView(groupedView,{
						animated:true,
						animationStyle:Titanium.UI.iPhone.AnimationStyle.FLIP_FROM_LEFT,
						animationDuration:1000
					});
					mode = 'UPDATE'
					firstName.setValue(e.contact.firstName);
					lastName.setValue(e.contact.lastName);
					email.setValue(e.contact.email[0].value);
					
			   	},
			   	cancel:function()
			   	{
			   	}
			});

		});
	
		//
		//  Create Table View to show contacts
		//
		var data = [{title:'No Contacts...'}];
		var template = {layout:[{name:'title', fontSize:20, fontWeight:'bold',left:10, type:'text', color:'black'}]};
		var tableView = Titanium.UI.createTableView({template:template,data:data}, function(e)
		{
			if (e.index ==0)
			{
				Titanium.UI.currentWindow.showView(Titanium.UI.currentWindow.getViews()[0],{
					animated:true,
					animationStyle:Titanium.UI.iPhone.AnimationStyle.FLIP_FROM_LEFT,
					animationDuration:1000
				});
				
			}
		});
		
		// create grouped view for adding contacts
		var firstName = Titanium.UI.createTextField({width:100,hintText:'first name'});
		firstName.addEventListener('return',function(e)
		{
			lastName.focus();
		});
		var lastName = Titanium.UI.createTextField({width:100,hintText:'first name'});
		lastName.addEventListener('return',function(e)
		{
			email.focus();
		});
		var email = Titanium.UI.createTextField({width:100,hintText:'first name'});
		email.addEventListener('return',function(e)
		{
			email.blur();
		});

		var inputData = [
			{title:'First Name', input:firstName, fontSize:16},
			{title:'Last Name', input:lastName,fontSize:16},
			{title:'Email', input:email,fontSize:16}
		];

		var inputSection = Titanium.UI.iPhone.createGroupedSection({
			header:'Manage Contact',
			type:'input',
			data:inputData
		});
		
		var buttonData = [
			{title:'Save Contact'},
			{title:'Go Back'}
		];
		var buttonSection = Titanium.UI.iPhone.createGroupedSection({
			type:'button',
			data:buttonData
		});
		buttonSection.addEventListener('click', function(e)
		{
			if (e.row==1)
			{
				Titanium.UI.currentWindow.showView(Titanium.UI.currentWindow.getViews()[0],{
					animated:true,
					animationStyle:Titanium.UI.iPhone.AnimationStyle.FLIP_FROM_LEFT,
					animationDuration:1000
				});
			}
			else
			{
				if (mode == 'UPDATE')
				{
					// update contact
					contactToUpdate.firstName = firstName.value;
					contactToUpdate.lastName = lastName.value;
					contactToUpdate.email = [{label:'home', value:email.value}]
					Titanium.Contacts.saveContact(contactToUpdate);

					// show main view
					Titanium.UI.currentWindow.showView(Titanium.UI.currentWindow.getViews()[0],{
						animated:true,
						animationStyle:Titanium.UI.iPhone.AnimationStyle.FLIP_FROM_LEFT,
						animationDuration:1000
					});
					
					
				}
				else
				{
					// add contact
					var c = Titanium.Contacts.createContact({
					    firstName:firstName.value,
					    lastName:lastName.value,
						email:[{label:'home', value:email.value}]
					});
					Titanium.Contacts.addContact(c);
					Titanium.UI.createAlertDialog({title:'Contacts',message:'Contact Added.'}).show();
					
				}
				
			}
		});
		var groupedView = Titanium.UI.iPhone.createGroupedView();
		groupedView.addSection(inputSection);
		groupedView.addSection(buttonSection);
		
		
		// add views
		Titanium.UI.currentWindow.addView(groupedView);
		Titanium.UI.currentWindow.addView(tableView);
		Titanium.UI.currentWindow.addView(detailTableView);

	};
	
	
	</script>
</head>
<body  style="font-family:'Helvetica Neue'">
	<div id="button1" style="height:60px"></div>
	<div id="button2" style="height:60px"></div>
	<div id="button3" style="height:60px"></div>
	<div id="button4" style="height:60px"></div>
	<div id="button6" style="height:60px"></div>
	<div id="button5" style="height:60px"></div>
</body>